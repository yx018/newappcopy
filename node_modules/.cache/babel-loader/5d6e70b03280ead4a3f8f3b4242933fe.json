{"ast":null,"code":"var _jsxFileName = \"/Users/yangxu/newapp/src/MyComponent.js\",\n    _s = $RefreshSig$();\n\nimport { useOpenCv } from 'opencv-react';\nimport VideoCanvas from './VideoCanvas';\nimport { useEffect, useState } from 'react';\nimport Utils from './utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction MyComponent() {\n  _s();\n\n  const {\n    loaded,\n    cv\n  } = useOpenCv();\n  const video = document.getElementById(\"video\");\n  const canvas = document.getElementById(\"canvas\");\n  var temCanvas = document.createElement('canvas');\n  const temCtx = temCanvas.getContext(\"2d\");\n  const img_previous = new Image();\n  const img_now = new Image(); // if (video.srcObject!= null)\n  // temCtx.drawImage(video, 0, 0);\n\n  const [count, setCount] = useState(0);\n  const [videoLoaded, setVideoLoaded] = useState(false);\n\n  if (video) {\n    video.addEventListener('loadVideo', () => {\n      if (video.src != null) setVideoLoaded(true);\n    });\n  }\n\n  useEffect(() => {\n    if (cv) {\n      console.log(cv);\n      console.log(loaded);\n      console.log(\"count: \" + count);\n\n      if (video.srcObject != null) {\n        temCtx.drawImage(video, 0, 0);\n        img_previous.src = \"https://en.wikipedia.org/wiki/Chinese_University_of_Hong_Kong#/media/File:CUHK.svg\";\n        temCtx.drawImage(video, 0, 0);\n        img_now.src = temCanvas.toDataURL('image/png');\n        console.log(img_previous);\n        console.log(img_now);\n        if (img_previous.src != img_now.src) img_previous.src = img_now.src; // setCount(count+1);\n\n        console.log(count);\n      }\n\n      const FPS = 30; // const processVideo = () =>{\n      //     if (video.srcObject!= null)\n      //     {\n      //         // console.log(video.srcObject);\n      //         let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);\n      //         let dst = new cv.Mat(video.height, video.width, cv.CV_8UC1);\n      //         let gray = new cv.Mat();\n      //         let cap = new cv.VideoCapture(video);\n      //         let faces = new cv.RectVector();\n      //         let classifier = new cv.CascadeClassifier();\n      //         let faceCascadeFile = 'haarcascade_frontalface_default.xml'; // path to xml\n      //         // let utils = new Utils(cv, 'errorMessage');\n      //         // utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {\n      //         //     classifier.load(faceCascadeFile); // in the callback, load the cascade from file \n      //         // });\n      //         console.log(classifier);\n      //         const detectFace = () => {\n      //             var begin = Date.now();\n      //             cap.read(src);\n      //             src.copyTo(dst);\n      //             cv.cvtColor(dst, gray, cv.COLOR_RGBA2GRAY, 0);\n      //             // try{\n      //             //     classifier.detectMultiScale(gray, faces, 1.1, 3, 0);\n      //             //     console.log(faces.size());\n      //             // }catch(err){\n      //             //     console.log(err);\n      //             // }\n      //             // for (let i = 0; i < faces.size(); ++i) {\n      //             //     let face = faces.get(i);\n      //             //     let point1 = new cv.Point(face.x, face.y);\n      //             //     let point2 = new cv.Point(face.x + face.width, face.y + face.height);\n      //             //     cv.rectangle(dst, point1, point2, [255, 0, 0, 255]);\n      //             // }\n      //             cv.imshow(\"canvas\", dst);\n      //             // schedule next one.\n      //             let delay = 1000/FPS - (Date.now() - begin);\n      //             setTimeout(detectFace, delay);\n      //             console.log(\"detect\");\n      //         }\n      //         setTimeout(detectFace, 0);\n      //         setTimeout(() => { clearInterval(timer) }, 0);\n      //     }\n      //     // console.log(\"AAA\");\n      //     let timer = setTimeout(processVideo, 10);\n      //     console.log(\"delay\");\n      // }\n      // // schedule first one.\n      // setTimeout(processVideo, 0);\n    }\n  }, [cv, count, videoLoaded]); // const cv = useOpenCv()\n  // console.log(cv)\n  // const video = document.getElementById(\"video\");\n  // let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);\n  // let dst = new cv.Mat(video.height, video.width, cv.CV_8UC1);\n  // let gray = new cv.Mat();\n  // let cap = new cv.VideoCapture(video);\n  // let faces = new cv.RectVector();\n  // let classifier = new cv.CascadeClassifier();\n  // let faceCascadeFile = 'haarcascade_frontalface_default.xml'; // path to xml\n  // classifier.load(faceCascadeFile);\n  // console.log(classifier);\n  // function onOpenUtilsReady() {\n  //     let utils = new Utils('errorMessage');\n  //     utils.loadOpenCv(() => {\n  //     let faceCascadeFile = 'haarcascade_frontalface_default.xml';\n  //         utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {\n  //             document.getElementById('status').innerHTML = 'OpenCV.js is ready.';\n  //         });\n  //     });\n  // }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      id: \"status\",\n      children: \"OpenCV.js is loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(VideoCanvas, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n\n_s(MyComponent, \"h9ro0BHJdAOcVjzaOypUggy9LRU=\", false, function () {\n  return [useOpenCv];\n});\n\n_c = MyComponent;\nexport default MyComponent;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyComponent\");","map":{"version":3,"sources":["/Users/yangxu/newapp/src/MyComponent.js"],"names":["useOpenCv","VideoCanvas","useEffect","useState","Utils","MyComponent","loaded","cv","video","document","getElementById","canvas","temCanvas","createElement","temCtx","getContext","img_previous","Image","img_now","count","setCount","videoLoaded","setVideoLoaded","addEventListener","src","console","log","srcObject","drawImage","toDataURL","FPS"],"mappings":"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","sourcesContent":["import { useOpenCv } from 'opencv-react'\nimport VideoCanvas from './VideoCanvas';\nimport {useEffect, useState} from 'react'\nimport Utils from './utils'\n\nfunction MyComponent() {\n    const { loaded, cv } = useOpenCv();\n    const video = document.getElementById(\"video\");\n    const canvas = document.getElementById(\"canvas\");\n    var temCanvas = document.createElement('canvas');\n    const temCtx = temCanvas.getContext(\"2d\");\n    const img_previous = new Image();\n    const img_now = new Image();\n    // if (video.srcObject!= null)\n    // temCtx.drawImage(video, 0, 0);\n\n    const [count, setCount] = useState(0);\n    const [videoLoaded, setVideoLoaded] = useState(false);\n\n    if(video){\n        video.addEventListener('loadVideo', ()=>{\n            if(video.src!=null)\n                setVideoLoaded(true);\n        })\n    }\n    \n    \n\n    useEffect(() => {\n        if (cv) {\n            console.log(cv);\n            console.log(loaded);\n            console.log(\"count: \"+ count);\n            \n            if (video.srcObject!= null){\n                temCtx.drawImage(video, 0, 0);\n                img_previous.src = \"https://en.wikipedia.org/wiki/Chinese_University_of_Hong_Kong#/media/File:CUHK.svg\";\n                temCtx.drawImage(video, 0, 0);\n                img_now.src = temCanvas.toDataURL('image/png');\n                console.log(img_previous);\n                console.log(img_now);\n                if (img_previous.src != img_now.src)\n                    img_previous.src = img_now.src;\n                    // setCount(count+1);\n                console.log(count);\n            }\n\n            const FPS = 30;\n\n            // const processVideo = () =>{\n                \n            //     if (video.srcObject!= null)\n            //     {\n            //         // console.log(video.srcObject);\n            //         let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);\n            //         let dst = new cv.Mat(video.height, video.width, cv.CV_8UC1);\n            //         let gray = new cv.Mat();\n            //         let cap = new cv.VideoCapture(video);\n            //         let faces = new cv.RectVector();\n            //         let classifier = new cv.CascadeClassifier();\n            //         let faceCascadeFile = 'haarcascade_frontalface_default.xml'; // path to xml\n            //         // let utils = new Utils(cv, 'errorMessage');\n            //         // utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {\n            //         //     classifier.load(faceCascadeFile); // in the callback, load the cascade from file \n            //         // });\n            //         console.log(classifier);\n                    \n            //         const detectFace = () => {\n            //             var begin = Date.now();\n            //             cap.read(src);\n            //             src.copyTo(dst);\n            //             cv.cvtColor(dst, gray, cv.COLOR_RGBA2GRAY, 0);\n            //             // try{\n            //             //     classifier.detectMultiScale(gray, faces, 1.1, 3, 0);\n            //             //     console.log(faces.size());\n            //             // }catch(err){\n            //             //     console.log(err);\n            //             // }\n            //             // for (let i = 0; i < faces.size(); ++i) {\n            //             //     let face = faces.get(i);\n            //             //     let point1 = new cv.Point(face.x, face.y);\n            //             //     let point2 = new cv.Point(face.x + face.width, face.y + face.height);\n            //             //     cv.rectangle(dst, point1, point2, [255, 0, 0, 255]);\n            //             // }\n            //             cv.imshow(\"canvas\", dst);\n                        \n                        \n            //             // schedule next one.\n            //             let delay = 1000/FPS - (Date.now() - begin);\n            //             setTimeout(detectFace, delay);\n            //             console.log(\"detect\");\n            //         }\n            //         setTimeout(detectFace, 0);\n            //         setTimeout(() => { clearInterval(timer) }, 0);\n            //     }\n            //     // console.log(\"AAA\");\n            //     let timer = setTimeout(processVideo, 10);\n            //     console.log(\"delay\");\n                \n            // }\n            // // schedule first one.\n            // setTimeout(processVideo, 0);\n\n        }\n    }, [cv, count, videoLoaded])\n\n    // const cv = useOpenCv()\n    // console.log(cv)\n\n    // const video = document.getElementById(\"video\");\n    // let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);\n    // let dst = new cv.Mat(video.height, video.width, cv.CV_8UC1);\n    // let gray = new cv.Mat();\n    // let cap = new cv.VideoCapture(video);\n    // let faces = new cv.RectVector();\n    // let classifier = new cv.CascadeClassifier();\n\n    // let faceCascadeFile = 'haarcascade_frontalface_default.xml'; // path to xml\n    // classifier.load(faceCascadeFile);\n    // console.log(classifier);\n\n    // function onOpenUtilsReady() {\n    //     let utils = new Utils('errorMessage');\n    //     utils.loadOpenCv(() => {\n    //     let faceCascadeFile = 'haarcascade_frontalface_default.xml';\n    //         utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {\n    //             document.getElementById('status').innerHTML = 'OpenCV.js is ready.';\n    //         });\n    //     });\n    // }\n\n    return (\n        <>\n        <p id=\"status\">OpenCV.js is loading...</p>\n        <VideoCanvas />\n        {/* <script async src=\"./utils.js\" onLoad={onOpenUtilsReady} type=\"text/javascript\"></script> */}\n        </>\n        \n    )\n}\n\n\n\nexport default MyComponent;\n\n\n"]},"metadata":{},"sourceType":"module"}