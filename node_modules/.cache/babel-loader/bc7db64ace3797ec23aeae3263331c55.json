{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { OpenCvProvider, useOpenCv } from 'opencv-react';\nimport { React, useEffect } from 'react';\n\nfunction Utils(errorOutputId) {\n  _s();\n\n  // eslint-disable-line no-unused-vars\n  const {\n    loaded,\n    cv\n  } = useOpenCv();\n  useEffect(() => {\n    if (cv) {\n      console.log('utils useEffect', cv);\n    }\n  }, [cv]);\n  let self = this;\n  this.errorOutput = document.getElementById(errorOutputId);\n  console.log(cv);\n  console.log(errorOutputId);\n  const OPENCV_URL = './opencv/opencv.js';\n\n  this.loadOpenCv = function (onloadCallback) {\n    let script = document.createElement('script');\n    script.setAttribute('async', '');\n    script.setAttribute('type', 'text/javascript');\n    script.setAttribute('id', 'utils');\n    script.addEventListener('load', () => {\n      if (cv.getBuildInformation) {\n        console.log(cv.getBuildInformation());\n        onloadCallback();\n      } else {\n        // WASM\n        cv['onRuntimeInitialized'] = () => {\n          console.log(cv.getBuildInformation());\n          onloadCallback();\n        };\n      }\n    });\n    script.addEventListener('error', () => {\n      self.printError('Failed to load ' + OPENCV_URL);\n    });\n    script.src = OPENCV_URL;\n    let node = document.getElementsByTagName('script')[0];\n    node.parentNode.insertBefore(script, node);\n  };\n\n  this.createFileFromUrl = function (path, url, callback) {\n    let request = new XMLHttpRequest();\n    request.open('GET', url, true);\n    request.responseType = 'arraybuffer';\n    console.log(request);\n\n    request.onload = function (ev) {\n      if (request.readyState === 4) {\n        if (request.status === 200) {\n          let data = new Uint8Array(request.response); // cv.FS_createDataFile('/', path, data, true, false, false);\n\n          callback(); // console.log(callback);\n\n          console.log(request.response);\n        } else {\n          self.printError('Failed to load ' + url + ' status: ' + request.status);\n        }\n      }\n    };\n\n    request.send();\n  };\n\n  this.loadImageToCanvas = function (url, cavansId) {\n    let canvas = document.getElementById(cavansId);\n    let ctx = canvas.getContext('2d');\n    let img = new Image();\n    img.crossOrigin = 'anonymous';\n\n    img.onload = function () {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n    };\n\n    img.src = url;\n  };\n\n  this.executeCode = function (textAreaId) {\n    try {\n      this.clearError();\n      let code = document.getElementById(textAreaId).value;\n      eval(code);\n    } catch (err) {\n      this.printError(err);\n    }\n  };\n\n  this.clearError = function () {\n    this.errorOutput.innerHTML = '';\n  };\n\n  this.printError = function (err) {\n    if (typeof err === 'undefined') {\n      err = '';\n    } else if (typeof err === 'number') {\n      if (!isNaN(err)) {\n        if (typeof cv !== 'undefined') {\n          err = 'Exception: ' + cv.exceptionFromPtr(err).msg;\n        }\n      }\n    } else if (typeof err === 'string') {\n      let ptr = Number(err.split(' ')[0]);\n\n      if (!isNaN(ptr)) {\n        if (typeof cv !== 'undefined') {\n          err = 'Exception: ' + cv.exceptionFromPtr(ptr).msg;\n        }\n      }\n    } else if (err instanceof Error) {\n      err = err.stack.replace(/\\n/g, '<br>');\n    }\n\n    this.errorOutput.innerHTML = err;\n  };\n\n  this.loadCode = function (scriptId, textAreaId) {\n    let scriptNode = document.getElementById(scriptId);\n    let textArea = document.getElementById(textAreaId);\n\n    if (scriptNode.type !== 'text/code-snippet') {\n      throw Error('Unknown code snippet type');\n    }\n\n    textArea.value = scriptNode.text.replace(/^\\n/, '');\n  };\n\n  this.addFileInputHandler = function (fileInputId, canvasId) {\n    let inputElement = document.getElementById(fileInputId);\n    inputElement.addEventListener('change', e => {\n      let files = e.target.files;\n\n      if (files.length > 0) {\n        let imgUrl = URL.createObjectURL(files[0]);\n        self.loadImageToCanvas(imgUrl, canvasId);\n      }\n    }, false);\n  };\n\n  function onVideoCanPlay() {\n    if (self.onCameraStartedCallback) {\n      self.onCameraStartedCallback(self.stream, self.video);\n    }\n  }\n\n  ;\n\n  this.startCamera = function (resolution, callback, videoId) {\n    const constraints = {\n      'qvga': {\n        width: {\n          exact: 320\n        },\n        height: {\n          exact: 240\n        }\n      },\n      'vga': {\n        width: {\n          exact: 640\n        },\n        height: {\n          exact: 480\n        }\n      }\n    };\n    let video = document.getElementById(videoId);\n\n    if (!video) {\n      video = document.createElement('video');\n    }\n\n    let videoConstraint = constraints[resolution];\n\n    if (!videoConstraint) {\n      videoConstraint = true;\n    }\n\n    navigator.mediaDevices.getUserMedia({\n      video: videoConstraint,\n      audio: false\n    }).then(function (stream) {\n      video.srcObject = stream;\n      video.play();\n      self.video = video;\n      self.stream = stream;\n      self.onCameraStartedCallback = callback;\n      video.addEventListener('canplay', onVideoCanPlay, false);\n    }).catch(function (err) {\n      self.printError('Camera Error: ' + err.name + ' ' + err.message);\n    });\n  };\n\n  this.stopCamera = function () {\n    if (this.video) {\n      this.video.pause();\n      this.video.srcObject = null;\n      this.video.removeEventListener('canplay', onVideoCanPlay);\n    }\n\n    if (this.stream) {\n      this.stream.getVideoTracks()[0].stop();\n    }\n  };\n}\n\n_s(Utils, \"UIea8lFmfe2lGJ/UwKqtq8/rXNE=\", false, function () {\n  return [useOpenCv];\n});\n\n_c = Utils;\n;\nexport default Utils;\n\nvar _c;\n\n$RefreshReg$(_c, \"Utils\");","map":{"version":3,"sources":["/Users/yangxu/newapp/src/utils.js"],"names":["OpenCvProvider","useOpenCv","React","useEffect","Utils","errorOutputId","loaded","cv","console","log","self","errorOutput","document","getElementById","OPENCV_URL","loadOpenCv","onloadCallback","script","createElement","setAttribute","addEventListener","getBuildInformation","printError","src","node","getElementsByTagName","parentNode","insertBefore","createFileFromUrl","path","url","callback","request","XMLHttpRequest","open","responseType","onload","ev","readyState","status","data","Uint8Array","response","send","loadImageToCanvas","cavansId","canvas","ctx","getContext","img","Image","crossOrigin","width","height","drawImage","executeCode","textAreaId","clearError","code","value","eval","err","innerHTML","isNaN","exceptionFromPtr","msg","ptr","Number","split","Error","stack","replace","loadCode","scriptId","scriptNode","textArea","type","text","addFileInputHandler","fileInputId","canvasId","inputElement","e","files","target","length","imgUrl","URL","createObjectURL","onVideoCanPlay","onCameraStartedCallback","stream","video","startCamera","resolution","videoId","constraints","exact","videoConstraint","navigator","mediaDevices","getUserMedia","audio","then","srcObject","play","catch","name","message","stopCamera","pause","removeEventListener","getVideoTracks","stop"],"mappings":"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","sourcesContent":["import { OpenCvProvider, useOpenCv } from 'opencv-react'\nimport {React, useEffect} from 'react'\n\nfunction Utils(errorOutputId) { // eslint-disable-line no-unused-vars\n\n    const { loaded, cv } = useOpenCv()\n\n    useEffect(() => {\n        if (cv) {\n            console.log('utils useEffect', cv);\n        }\n    }, [cv])\n\n\n    let self = this;\n    this.errorOutput = document.getElementById(errorOutputId);\n\n    console.log(cv);\n    console.log(errorOutputId);\n    const OPENCV_URL = './opencv/opencv.js';\n    this.loadOpenCv = function(onloadCallback) {\n        let script = document.createElement('script');\n        script.setAttribute('async', '');\n        script.setAttribute('type', 'text/javascript');\n        script.setAttribute('id', 'utils');\n        script.addEventListener('load', () => {\n            if (cv.getBuildInformation)\n            {\n                console.log(cv.getBuildInformation());\n                onloadCallback();\n            }\n            else\n            {\n                // WASM\n                cv['onRuntimeInitialized']=()=>{\n                    console.log(cv.getBuildInformation());\n                    onloadCallback();\n                }\n            }\n        });\n        script.addEventListener('error', () => {\n            self.printError('Failed to load ' + OPENCV_URL);\n        });\n        script.src = OPENCV_URL;\n        let node = document.getElementsByTagName('script')[0];\n        node.parentNode.insertBefore(script, node);\n    };\n\n    this.createFileFromUrl = function(path, url, callback) {\n        let request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.responseType = 'arraybuffer';\n        console.log(request);\n        request.onload = function(ev) {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    let data = new Uint8Array(request.response);\n                    // cv.FS_createDataFile('/', path, data, true, false, false);\n                    callback();\n                    // console.log(callback);\n                    console.log(request.response);\n                } else {\n                    self.printError('Failed to load ' + url + ' status: ' + request.status);\n                }\n            }\n        };\n        request.send();\n    };\n\n    this.loadImageToCanvas = function(url, cavansId) {\n        let canvas = document.getElementById(cavansId);\n        let ctx = canvas.getContext('2d');\n        let img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onload = function() {\n            canvas.width = img.width;\n            canvas.height = img.height;\n            ctx.drawImage(img, 0, 0, img.width, img.height);\n        };\n        img.src = url;\n    };\n\n    this.executeCode = function(textAreaId) {\n        try {\n            this.clearError();\n            let code = document.getElementById(textAreaId).value;\n            eval(code);\n        } catch (err) {\n            this.printError(err);\n        }\n    };\n\n    this.clearError = function() {\n        this.errorOutput.innerHTML = '';\n    };\n\n    this.printError = function(err) {\n        if (typeof err === 'undefined') {\n            err = '';\n        } else if (typeof err === 'number') {\n            if (!isNaN(err)) {\n                if (typeof cv !== 'undefined') {\n                    err = 'Exception: ' + cv.exceptionFromPtr(err).msg;\n                }\n            }\n        } else if (typeof err === 'string') {\n            let ptr = Number(err.split(' ')[0]);\n            if (!isNaN(ptr)) {\n                if (typeof cv !== 'undefined') {\n                    err = 'Exception: ' + cv.exceptionFromPtr(ptr).msg;\n                }\n            }\n        } else if (err instanceof Error) {\n            err = err.stack.replace(/\\n/g, '<br>');\n        }\n        this.errorOutput.innerHTML = err;\n    };\n\n    this.loadCode = function(scriptId, textAreaId) {\n        let scriptNode = document.getElementById(scriptId);\n        let textArea = document.getElementById(textAreaId);\n        if (scriptNode.type !== 'text/code-snippet') {\n            throw Error('Unknown code snippet type');\n        }\n        textArea.value = scriptNode.text.replace(/^\\n/, '');\n    };\n\n    this.addFileInputHandler = function(fileInputId, canvasId) {\n        let inputElement = document.getElementById(fileInputId);\n        inputElement.addEventListener('change', (e) => {\n            let files = e.target.files;\n            if (files.length > 0) {\n                let imgUrl = URL.createObjectURL(files[0]);\n                self.loadImageToCanvas(imgUrl, canvasId);\n            }\n        }, false);\n    };\n\n    function onVideoCanPlay() {\n        if (self.onCameraStartedCallback) {\n            self.onCameraStartedCallback(self.stream, self.video);\n        }\n    };\n\n    this.startCamera = function(resolution, callback, videoId) {\n        const constraints = {\n            'qvga': {width: {exact: 320}, height: {exact: 240}},\n            'vga': {width: {exact: 640}, height: {exact: 480}}};\n        let video = document.getElementById(videoId);\n        if (!video) {\n            video = document.createElement('video');\n        }\n\n        let videoConstraint = constraints[resolution];\n        if (!videoConstraint) {\n            videoConstraint = true;\n        }\n\n        navigator.mediaDevices.getUserMedia({video: videoConstraint, audio: false})\n            .then(function(stream) {\n                video.srcObject = stream;\n                video.play();\n                self.video = video;\n                self.stream = stream;\n                self.onCameraStartedCallback = callback;\n                video.addEventListener('canplay', onVideoCanPlay, false);\n            })\n            .catch(function(err) {\n                self.printError('Camera Error: ' + err.name + ' ' + err.message);\n            });\n    };\n\n    this.stopCamera = function() {\n        if (this.video) {\n            this.video.pause();\n            this.video.srcObject = null;\n            this.video.removeEventListener('canplay', onVideoCanPlay);\n        }\n        if (this.stream) {\n            this.stream.getVideoTracks()[0].stop();\n        }\n    };\n};\n\nexport default Utils;"]},"metadata":{},"sourceType":"module"}