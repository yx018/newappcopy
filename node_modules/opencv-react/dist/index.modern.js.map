{"version":3,"file":"index.modern.js","sources":["../src/lib/OpenCvProvider.js","../src/lib/useOpenCv.js"],"sourcesContent":["import * as React from 'react'\n\nconst OpenCvContext = React.createContext()\n\nconst { Consumer: OpenCvConsumer, Provider } = OpenCvContext\n\nexport { OpenCvConsumer, OpenCvContext }\n\nconst scriptId = 'opencv-react'\nconst moduleConfig = {\n  wasmBinaryFile: 'opencv_js.wasm',\n  usingWasm: true\n}\n\nexport const OpenCvProvider = ({ openCvPath, children, onLoad }) => {\n  const [loaded, setLoaded] = React.useState(false)\n\n  const handleOnLoad = React.useCallback(() => {\n    if (onLoad) {\n      onLoad(window.cv)\n    }\n    setLoaded(true)\n  }, [])\n\n  React.useEffect(() => {\n    if (document.getElementById(scriptId) || window.cv) {\n      setLoaded(true)\n      return\n    }\n\n    // https://docs.opencv.org/3.4/dc/de6/tutorial_js_nodejs.html\n    // https://medium.com/code-divoire/integrating-opencv-js-with-an-angular-application-20ae11c7e217\n    // https://stackoverflow.com/questions/56671436/cv-mat-is-not-a-constructor-opencv\n    moduleConfig.onRuntimeInitialized = handleOnLoad\n    window.Module = moduleConfig\n\n    const generateOpenCvScriptTag = () => {\n      const js = document.createElement('script')\n      js.id = scriptId\n      js.src = openCvPath || 'https://docs.opencv.org/3.4.13/opencv.js'\n\n      js.nonce = true\n      js.defer = true\n      js.async = true\n\n      return js\n    }\n\n    document.body.appendChild(generateOpenCvScriptTag())\n  }, [openCvPath, handleOnLoad])\n\n  const memoizedProviderValue = React.useMemo(\n    () => ({ loaded, cv: window.cv }),\n    [loaded]\n  )\n\n  return <Provider value={memoizedProviderValue}>{children}</Provider>\n}\n","import * as React from 'react'\nimport { OpenCvContext } from './OpenCvProvider'\n\nexport const useOpenCv = () => React.useContext(OpenCvContext)\n"],"names":["OpenCvContext","React","OpenCvConsumer","Consumer","Provider","scriptId","moduleConfig","wasmBinaryFile","usingWasm","OpenCvProvider","openCvPath","children","onLoad","loaded","setLoaded","handleOnLoad","window","cv","document","getElementById","onRuntimeInitialized","Module","generateOpenCvScriptTag","js","createElement","id","src","nonce","defer","async","body","appendChild","memoizedProviderValue","React.createElement","useOpenCv"],"mappings":";;IAEMA,aAAa,GAAGC,aAAA;IAEJC,iBAA6BF,cAAvCG;IAA0BC,WAAaJ,cAAbI;AAIlC,IAAMC,QAAQ,GAAG,cAAjB;AACA,IAAMC,YAAY,GAAG;AACnBC,EAAAA,cAAc,EAAE,gBADG;AAEnBC,EAAAA,SAAS,EAAE;AAFQ,CAArB;IAKaC,cAAc,GAAG,SAAjBA,cAAiB,OAAsC;AAAA,MAAnCC,UAAmC,QAAnCA,UAAmC;AAAA,MAAvBC,QAAuB,QAAvBA,QAAuB;AAAA,MAAbC,MAAa,QAAbA,MAAa;;AAAA,wBACtCX,QAAA,CAAe,KAAf,CADsC;AAAA,MAC3DY,MAD2D;AAAA,MACnDC,SADmD;;AAGlE,MAAMC,YAAY,GAAGd,WAAA,CAAkB,YAAM;AAC3C,QAAIW,MAAJ,EAAY;AACVA,MAAAA,MAAM,CAACI,MAAM,CAACC,EAAR,CAAN;AACD;;AACDH,IAAAA,SAAS,CAAC,IAAD,CAAT;AACD,GALoB,EAKlB,EALkB,CAArB;AAOAb,EAAAA,SAAA,CAAgB,YAAM;AACpB,QAAIiB,QAAQ,CAACC,cAAT,CAAwBd,QAAxB,KAAqCW,MAAM,CAACC,EAAhD,EAAoD;AAClDH,MAAAA,SAAS,CAAC,IAAD,CAAT;AACA;AACD;;AAKDR,IAAAA,YAAY,CAACc,oBAAb,GAAoCL,YAApC;AACAC,IAAAA,MAAM,CAACK,MAAP,GAAgBf,YAAhB;;AAEA,QAAMgB,uBAAuB,GAAG,SAA1BA,uBAA0B,GAAM;AACpC,UAAMC,EAAE,GAAGL,QAAQ,CAACM,aAAT,CAAuB,QAAvB,CAAX;AACAD,MAAAA,EAAE,CAACE,EAAH,GAAQpB,QAAR;AACAkB,MAAAA,EAAE,CAACG,GAAH,GAAShB,UAAU,IAAI,0CAAvB;AAEAa,MAAAA,EAAE,CAACI,KAAH,GAAW,IAAX;AACAJ,MAAAA,EAAE,CAACK,KAAH,GAAW,IAAX;AACAL,MAAAA,EAAE,CAACM,KAAH,GAAW,IAAX;AAEA,aAAON,EAAP;AACD,KAVD;;AAYAL,IAAAA,QAAQ,CAACY,IAAT,CAAcC,WAAd,CAA0BT,uBAAuB,EAAjD;AACD,GAzBD,EAyBG,CAACZ,UAAD,EAAaK,YAAb,CAzBH;AA2BA,MAAMiB,qBAAqB,GAAG/B,OAAA,CAC5B;AAAA,WAAO;AAAEY,MAAAA,MAAM,EAANA,MAAF;AAAUI,MAAAA,EAAE,EAAED,MAAM,CAACC;AAArB,KAAP;AAAA,GAD4B,EAE5B,CAACJ,MAAD,CAF4B,CAA9B;AAKA,sBAAOoB,cAAC,QAAD;AAAU,IAAA,KAAK,EAAED;AAAjB,KAAyCrB,QAAzC,CAAP;AACD;;ICtDYuB,SAAS,GAAG,SAAZA,SAAY;AAAA,SAAMjC,UAAA,CAAiBD,aAAjB,CAAN;AAAA,CAAlB;;;;"}